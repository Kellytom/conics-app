<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Parabolas - Conics Explorer</title>
    <!-- CONIC PLAN REFERENCE: Implements Phase 1 (Foundation) for parabola visualization
         Supporting "Mathematical Precision" and "Integer Lattice Points" principles -->
    
    <!-- CDN Dependencies -->
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@3.3.6/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/daisyui@4.4.19/dist/full.css" rel="stylesheet">
    <script src="https://d3js.org/d3.v7.min.js"></script>
    
    <!-- Custom Conic Styles -->
    <link rel="stylesheet" href="css/conics-custom.css">
    
    <!-- Print Optimizations -->
    <style>
        @page { 
            size: A4; 
            margin: 2cm; 
        }
        
        @media print {
            body { 
                background: white !important; 
                color: black !important; 
            }
            .conic-curve { 
                stroke: black !important; 
            }
            .lattice-point { 
                fill: black !important; 
                stroke: black !important; 
            }
            .print-hidden { 
                display: none !important; 
            }
        }
        
        /* Garamond font for mathematical clarity */
        .font-garamond {
            font-family: 'Garamond', 'Georgia', serif;
        }
        
        /* Custom conic colors */
        .conic-parabola { stroke: #e74c3c; stroke-width: 2; fill: none; }
        .conic-ellipse { stroke: #3498db; stroke-width: 2; fill: none; }
        .conic-circle { stroke: #2ecc71; stroke-width: 2; fill: none; }
        .conic-hyperbola { stroke: #9b59b6; stroke-width: 2; fill: none; }
        
        .lattice-point { 
            fill: #333; 
            stroke: #000; 
            stroke-width: 1; 
        }
        
        .math-grid { 
            stroke: #e5e7eb; 
            stroke-width: 0.5; 
        }
        
        .math-axes { 
            stroke: #6b7280; 
            stroke-width: 1.5; 
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-900 font-sans">
    <!-- Navigation -->
    <nav class="print-hidden navbar bg-base-100 border-b border-gray-200">
        <div class="navbar-start">
            <a href="index.html" class="btn btn-ghost text-xl font-garamond">‚Üê Conics Explorer</a>
        </div>
        <div class="navbar-center">
            <div class="flex space-x-4">
                <a href="parabolas.html" class="btn btn-sm btn-primary">Parabolas</a>
                <a href="ellipses.html" class="btn btn-sm btn-ghost">Ellipses</a>
                <a href="circles.html" class="btn btn-sm btn-ghost">Circles</a>
                <a href="hyperbolas.html" class="btn btn-sm btn-ghost">Hyperbolas</a>
            </div>
        </div>
        <div class="navbar-end">
            <button id="mathModeToggle" class="btn btn-sm btn-outline">üìê Math Mode</button>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-8">
        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-4xl font-garamond font-bold text-gray-900 mb-4">
                üìà Parabolas & Lattice Intersections
            </h1>
            <div class="prose max-w-3xl mx-auto">
                <p class="text-lg text-gray-600">
                    Parabolas are defined by the equation <code class="bg-gray-100 px-2 py-1 rounded">y = x¬≤/a</code> 
                    where <code>a</code> is the scaling parameter. We explore parabolas with integer parameters 
                    that create precise lattice intersections, essential for craftsman reproduction and AI-driven assembly.
                </p>
            </div>
        </div>

        <!-- Parabola Cards Container -->
        <div id="parabolaCards" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            <!-- Cards will be generated by JavaScript -->
        </div>
    </main>

    <!-- JavaScript -->
    <script>
        // CONIC PLAN REFERENCE: Mathematical utilities supporting "Integer Lattice Points" validation
        const MathUtils = {
            round: (num, decimals = 2) => Math.round(num * Math.pow(10, decimals)) / Math.pow(10, decimals),
            
            isInteger: (num, tolerance = 1e-10) => Math.abs(num - Math.round(num)) < tolerance,
            
            isLatticePoint: (x, y, tolerance = 1e-10) => 
                MathUtils.isInteger(x, tolerance) && MathUtils.isInteger(y, tolerance),
            
            distance: (x1, y1, x2, y2) => Math.sqrt((x2 - x1) ** 2 + (y2 - y1) ** 2)
        };

        // CONIC PLAN REFERENCE: Parabola configurations supporting "Standard Proportions" from AI ground rules
        const parabolaConfigs = [
            { a: 1, color: '#e74c3c', title: 'Unit Parabola', equation: 'y = x¬≤' },
            { a: 4, color: '#e74c3c', title: 'Gentle Parabola', equation: 'y = x¬≤/4' },
            { a: 9, color: '#3498db', title: 'Wide Parabola', equation: 'y = x¬≤/9' },
            { a: 16, color: '#3498db', title: 'Very Wide', equation: 'y = x¬≤/16' },
            { a: 25, color: '#9b59b6', title: 'Shallow Curve', equation: 'y = x¬≤/25' },
            { a: 36, color: '#9b59b6', title: 'Ultra Wide', equation: 'y = x¬≤/36' },
            { a: 64, color: '#f39c12', title: 'Craft Scale', equation: 'y = x¬≤/64' },
            { a: 100, color: '#f39c12', title: 'Large Scale', equation: 'y = x¬≤/100' }
        ];

        // Generate parabola cards
        function generateParabolaCards() {
            const container = document.getElementById('parabolaCards');
            
            parabolaConfigs.forEach((config, index) => {
                const card = createParabolaCard(config, index);
                container.appendChild(card);
            });
        }

        function createParabolaCard(config, index) {
            const card = document.createElement('div');
            card.className = 'card bg-base-100 shadow-lg border border-gray-200 hover:shadow-xl transition-all duration-300';
            
            // Calculate bounds based on parameter 'a'
            const bounds = calculateBounds(config.a);
            const latticePoints = findLatticeIntersections(config.a, bounds);
            
            card.innerHTML = `
                <div class="card-body p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="card-title text-lg font-garamond">${config.title}</h3>
                        <code class="bg-gray-100 px-2 py-1 rounded text-sm">${config.equation}</code>
                    </div>
                    
                    <div class="bg-gray-50 rounded border p-4 mb-4">
                        <svg id="parabola-${index}" width="100%" height="300" viewBox="${bounds.viewBox}">
                            <!-- Grid, axes, and parabola will be drawn by D3 -->
                        </svg>
                    </div>
                    
                    <div class="text-sm text-gray-600">
                        <p><strong>Parameter a:</strong> ${config.a}</p>
                        <p><strong>Lattice Points:</strong> ${latticePoints.length} found</p>
                        <div class="math-details" style="display: none;">
                            <p><strong>Focus:</strong> (0, ${config.a/4})</p>
                            <p><strong>Directrix:</strong> y = ${-config.a/4}</p>
                            <p><strong>Vertex:</strong> (0, 0)</p>
                        </div>
                    </div>
                </div>
            `;
            
            // Draw the parabola using D3
            setTimeout(() => drawParabola(`parabola-${index}`, config, bounds, latticePoints), 50);
            
            return card;
        }

        function calculateBounds(a) {
            // PLAN REF: Adaptive coordinate system for different parameter ranges
            let xRange, yRange;
            
            if (a <= 4) {
                xRange = [-6, 6];
                yRange = [0, 12];
            } else if (a <= 25) {
                xRange = [-10, 10];
                yRange = [0, 20];
            } else if (a <= 100) {
                xRange = [-20, 20];
                yRange = [0, 25];
            } else {
                xRange = [-30, 30];
                yRange = [0, 30];
            }
            
            return {
                xMin: xRange[0], xMax: xRange[1],
                yMin: yRange[0], yMax: yRange[1],
                width: 400, height: 300,
                viewBox: `0 0 400 300`
            };
        }

        function findLatticeIntersections(a, bounds) {
            const points = [];
            
            for (let x = bounds.xMin; x <= bounds.xMax; x++) {
                if (Number.isInteger(x)) {
                    const y = (x * x) / a;
                    if (MathUtils.isInteger(y) && y >= bounds.yMin && y <= bounds.yMax) {
                        points.push({ x, y });
                    }
                }
            }
            
            return points;
        }

        function drawParabola(svgId, config, bounds, latticePoints) {
            const svg = d3.select(`#${svgId}`);
            svg.selectAll("*").remove();
            
            // Set up scales
            const xScale = d3.scaleLinear()
                .domain([bounds.xMin, bounds.xMax])
                .range([20, bounds.width - 20]);
                
            const yScale = d3.scaleLinear()
                .domain([bounds.yMax, bounds.yMin])  // Inverted for SVG
                .range([20, bounds.height - 20]);

            // Draw grid
            svg.selectAll(".grid-x")
                .data(d3.range(bounds.xMin, bounds.xMax + 1))
                .enter()
                .append("line")
                .attr("class", "math-grid")
                .attr("x1", d => xScale(d))
                .attr("x2", d => xScale(d))
                .attr("y1", 20)
                .attr("y2", bounds.height - 20);

            svg.selectAll(".grid-y")
                .data(d3.range(bounds.yMin, bounds.yMax + 1))
                .enter()
                .append("line")
                .attr("class", "math-grid")
                .attr("x1", 20)
                .attr("x2", bounds.width - 20)
                .attr("y1", d => yScale(d))
                .attr("y2", d => yScale(d));

            // Draw axes
            svg.append("line")
                .attr("class", "math-axes")
                .attr("x1", xScale(0))
                .attr("x2", xScale(0))
                .attr("y1", 20)
                .attr("y2", bounds.height - 20);

            svg.append("line")
                .attr("class", "math-axes")
                .attr("x1", 20)
                .attr("x2", bounds.width - 20)
                .attr("y1", yScale(0))
                .attr("y2", yScale(0));

            // Generate parabola path
            const parabolaData = d3.range(bounds.xMin, bounds.xMax + 0.1, 0.1)
                .map(x => {
                    const y = (x * x) / config.a;
                    return [x, y];
                })
                .filter(([x, y]) => y >= bounds.yMin && y <= bounds.yMax);

            const line = d3.line()
                .x(d => xScale(d[0]))
                .y(d => yScale(d[1]))
                .curve(d3.curveCardinal);

            svg.append("path")
                .datum(parabolaData)
                .attr("class", "conic-parabola")
                .attr("d", line);

            // Draw lattice points
            svg.selectAll(".lattice-point")
                .data(latticePoints)
                .enter()
                .append("circle")
                .attr("class", "lattice-point")
                .attr("cx", d => xScale(d.x))
                .attr("cy", d => yScale(d.y))
                .attr("r", 3);

            // Add lattice point labels in math mode
            svg.selectAll(".lattice-label")
                .data(latticePoints)
                .enter()
                .append("text")
                .attr("class", "lattice-label text-xs fill-gray-600")
                .attr("x", d => xScale(d.x) + 8)
                .attr("y", d => yScale(d.y) - 8)
                .text(d => `(${d.x},${d.y})`)
                .style("display", "none");
        }

        // Math mode toggle
        let mathMode = false;
        
        document.getElementById('mathModeToggle').addEventListener('click', function() {
            mathMode = !mathMode;
            this.textContent = mathMode ? 'üìê Math Mode ‚úì' : 'üìê Math Mode';
            this.classList.toggle('btn-primary', mathMode);
            
            // Toggle math details visibility
            document.querySelectorAll('.math-details').forEach(el => {
                el.style.display = mathMode ? 'block' : 'none';
            });
            
            document.querySelectorAll('.lattice-label').forEach(el => {
                el.style.display = mathMode ? 'block' : 'none';
            });
        });

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ Parabolas page loaded');
            generateParabolaCards();
        });
    </script>
</body>
</html>
